<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks</title>
    
    <script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>

</head>
<body>
    {% if user.is_authenticated %}
        <h1>Task List</h1>
    <form id="add-task-form" hx-post="{% url 'task-create' %}" hx-trigger="submit" hx-target="#task-list" hx-swap="beforeend">
        <input type="text" name="task" placeholder="Enter task">
        <button type="submit">Add Task</button>
    </form>
    <hr>

    <div id="task-list" hx-get="{% url 'task-list' %}">
        {% for task in tasks %}
            <button hx-patch="{% url 'task-complete' task.id %} ">Complete</button> - <ul>{{task.task}}</ul> - <button hx-delete="{% url 'task-delete' task.id %} " id="delete-button">Delete</button> <br>
        {% endfor %}
    </div>

    <hr>

    <button class='text-base font-bold bg-red-500 hover:bg-red-600 text-white rounded' hx-post="{% url 'logout' %}">Logout</button>

    {% else %}
    <h1>Login</h1>
    <form hx-post="{% url 'login' %}">
        <input type="text" name="username" placeholder="Username" required><br>
        <input type="password" name="password" placeholder="Password" required><br>
        <button type="submit">Login</button>
    </form>

    <hr>

    <h1>Register</h1>
    <form hx-post="{% url 'register' %}">
        <input type="text" name="username" placeholder="Username" required><br>
        <input type="email" name="email" placeholder="Email" required><br>
        <input type="password" name="password" placeholder="Password" required><br>
        <button type="submit">Register</button>
    </form>
    {% endif %}
</body>
<script>
    document.body.addEventListener('htmx:configRequest', (event) => {
        event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
    });

    document.body.addEventListener('htmx:afterRequest', (event) => {
        document.querySelector("input[name='task']").value = '';
        location.reload();
    });

</script>

</html>


